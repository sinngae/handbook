# 代码规范

## 代码注释
语言不同，注释格式不同，但注释必备要素是一样的。

+ TODO：英语翻译为待办事项，备忘录。如果代码中有该标识，说明在标识处有功能代码待编写，待实现的功能在说明中会简略说明。
+ FIXME：可以拆成短语，fix me ，意为修理我。如果代码中有该标识，说明标识处代码需要修正，甚至代码是错误的，不能工作，需要修复，如何修正会在说明中简略说明。
+ XXX：如果代码中有该标识，说明标识处代码虽然实现了功能，但是实现的方法有待商榷，希望将来能改进，要改进的地方会在说明中简略说明。
+ HACK：英语翻译为砍。如果代码中有该标识，说明标识处代码我们需要根据自己的需求去调整程序代码。

这几种标记VIM都是高亮的，eclipse等IDE一般也高亮，或者需要设置。

## 代码静态分析
可以把sonar代码静态分析加上。如果sonar的规则不合适，是可以改的；
code review中，如果发现有需求，也可以添加自定义规则，形成良性循环。
这样更高效地检查代码，也可以减轻一部分code review的工作量。


# 代码评审
不过度优化/设计，也不流于形式，把握基本原则，适可而止。
不恰当的代码评审可能会引起同事间的冲突，不利于团队建设。技术之外，多学做人。
评审应该放入跟踪，反馈要落到实处。可以建立个checklist/faq/best practise把问题和经验整理总结出来。

Google非常重视代码审查，任何产品/项目代码在入库之前都要进行有效的审查，每个人都要参与，而且被认为是开发活动中非常重要而且通用的规则。代码审查可以做到非常少的投入，并获得足够多产出。好的代码审查对于作者应该是建设性的指正，而不是代码风格之类的苛求，可以加速作者的成长。

找到bug是代码审查最没有价值的好处之一，团队内社交才是其最大的好处。分享知识是团队内社交的一大好处，团队内因此会互相关心负责的模块，并因此确保团队稳定。

代码审查者如果缺乏经验，会常常犯一些错误，对于团队很麻烦的错误，并扩散出去。比如审查者依据代码是否按自己的思路来判断代码是否正确。再比如，审查者总觉得自己应该挑出来什么，实际上，认同作者的成果也是一种结果。还比如，因为别人要求，所以应该立马并快速审查。不必拖延，但也不必匆匆了事。又比如，审查者卖弄技术，却不是积极和细心。内心是改变自己还是改变别人？

## 代码审核的好处
和QA测试活动相比，代码审核活动更容易更早发现某些代码缺陷，甚至可以发现QA测试发现不了的，如架构/时序上的问题。代码审核活动还可以提高团队成员编程技能，促进编程风格优化。
越早发现缺陷，项目成本越低，减少测试甚至运维的工作量。
团队的代码更整洁，具有良好注释，良好的组织结构，整个团队都会受益，而且会扩散到团队之外。
知识无形中在团队内分享，不再依赖某一个人。
开发者得到成长，并且更加努力。


## 团队审核文化
代码审核牵涉团队成员沟通，审核的往往不仅是代码缺陷，还有编程风格、设计、设计审核等等。虽然很多从业人员认为代码审核不应该是对程序员个体的审核，但是代码审核确实也是在审核人，这种观点只是在弱化或回避人际冲突。
处理好人际冲突是对的，代码审核也是好的，两者并不冲突。代码审核活动中，应该注意心理陷阱，A发现B的bug，并不意味着A比B厉害。这类陷阱会扩散，且影响团队协作。只有整个团队每个成员都意识到代码审核带来的好处，并能处理好人际交互，才能提高团队和个人的能力。
团队应该谨慎使用审查中的问题，测试中的问题的量作为考评依据。问题发向应该鼓励，被发现问题者不应该被处罚，过渡苛求无bug更是有悖常理。尤其造成参与者因怕承担项目责任或伤害他人的心理负担，而不愿指出问题，代码审查就减少了意义。


## 原则
startbear在思科调查结果总结在[10个原则](https://smartbear.com/learn/code-review/best-practices-for-peer-code-review/)

1. 每次评审不应超过400行；每小时评审应该不超过500行；每次评审不应超过一个小时；

更多工作压力会导致质量下降。
不同的开发语言和平台如git，代码审查的效率也是不同的。不同的开发语言，下述原则可能都是不同的。
如果可以，每次代码提交也不要超过400行。

2. 设定目标并测量指标

3. 评审前，作者应该先讲解一下
审查他人的代码往往缺少代入感，如果可以先带入，比如和作者交流提问，可以更容易开始代码审核。

4. 使用checklists 与 风格指南
代码风格&编码习惯/性能/安全/功能全备性/代码完整性&可读性/全局审视/未来视角

5. 建立缺陷的修复流程
评审者描述问题应当
发现的问题，应该由原作者确认并修改。保证问题被解决，且增进交流，促进成长。

6. 塑造积极向上的代码评审文化
会议形式评审代码效果并不好，但是可以把评审记录整理出来讨论checklists等做总结还是很好的。提前准备好评审记录和checklists要点，会提高会议效率。

7. 拥抱互相评审的潜意识作用
促进作者自我驱动和自我实现高质量的、可读性强的代码。
即使项目紧急，至少也要对关键部分代码做代码审核。
即使只有一个人，对自己的代码评审一下，也能提高代码质量（子曰三省吾身）。
8. 实践采用轻量级代码评审
使用轻量级的有效的辅助工具。
github/bitbucket

9. 尊重/遵守设计
代码审查可能会牵连设计，甚至设计审查。而设计需要灵感和更高层次的考虑，并避免复杂的逻辑。慎重地变更最初设计的初衷。



## 代码审核的开展
1. TDD实践
2. 自动化工具
PDM/Checkstype/Findbugs


## 参考
[go代码评审](https://github.com/golang/go/wiki/CodeReviewComments)