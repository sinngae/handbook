# CPU权限
大部分现代CPU架构都有某种形式的保护环，每一环具有不同级别的保护权限，可以调用不同的CPU资源级别。
Intel X86 CPU有Ring 0（kernel）/Ring 1（某些设备驱动）/Ring 2（设备驱动）/Ring 3（应用层）四个级别，还有一个Ring -3级别权限。常见的Windows/Linux/Andriod/iOS等操作系统没有完全使用各级别权限，Windows使用Ring 0用于内核代码和驱动程序，Ring 2用于某些特权代码（如需要I/O权限的用户程序），Ring 3用于一般代码（几乎包含所有的应用程序）。

CPU指令集中，有些指令是非常危险的，用错了会导致系统崩溃，比如清楚内存数据、设置时钟等。所以CPU指令集分为特权指令和普通指令，仅允许操作系统及其相关模块运行特权指令。特权指令如控制中断/修改页表/访问设备。

应用程序代码运行在Ring 3，不能访问特权指令。应用程序通过执行**系统调用**，间接访问特权指令，从Ring 3切换到Ring 0，跳转到系统调用对应的内核代码位置执行特权指令，执行完毕后再从Ring 0返回Ring 3（**也即用户态和内核态的切换**）。

RING的设计目标是通过隔离用户程序和特权指令，使得系统OS更好管理系统资源，运行更加稳定。比如终止用户进程，只需任务管理器即可终止。

RING的弊端是OS虚拟化技术的实现，虚拟OS需要RING 0权限，而Ring 0不能运行多个OS。早期虚拟机是把OS当作用户程序运行，开启的时候预分配给其的资源都被占用。Linux容器虚拟化不是模拟完整的OS，而是对进程的隔离（Ring 4？），容器里的进程访问的资源都是虚拟的，与底层系统是隔离的，主流的Linux容器是Docker。
虚拟机利用Intel的VT-d和VT-x的Ring 1硬件隔离，防止进程突破，而容器没有任何形式的硬件隔离，易受攻击。

CPU权限及指令集并非完美，如Intel曾有过ME管理引擎漏洞和Ring 0漏洞。