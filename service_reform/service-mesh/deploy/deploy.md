# 一、名词释义
发布策略
在K8S中，有几种不同的发布策略，包括滚动发布、蓝绿发布、灰度发布、金丝雀发布和AB发布。
1. 滚动发布（Rolling Update）
滚动发布是一种逐步更新应用程序的方法，它通过逐步替换旧的Pod实例来实现。在滚动发布期间，K8S会逐步将新版本的Pod实例添加到集群中，同时逐步删除旧版本的Pod实例。这种方法可以确保应用程序在更新期间保持可用性。
2. 蓝绿发布（Blue-Green Deployment）：
蓝绿发布是一种将新版本应用程序部署到与旧版本应用程序完全相同的环境中的方法。在蓝绿发布期间，新版本的应用程序会在一个完全独立的环境中运行，直到它被认为是稳定和可靠的。然后，旧版本的应用程序会被停止，新版本的应用程序会接管它的工作。
image.png
变种：绿部署先仅部署一个Pod，待测试通过后，再扩容到一组Pod。
3. 灰度发布（Canary Deployment）：
灰度发布是一种逐步将新版本应用程序部署到生产环境中的方法。在灰度发布期间，新版本的应用程序会逐步替换旧版本的应用程序，但只会在一小部分用户中使用。这种方法可以确保新版本的应用程序在生产环境中的稳定性和可靠性。这样可以在不影响所有用户的情况下测试新版本的应用程序，并在发现问题时及时回滚。
变种：第一步创建一个新版本的Pod，先不提供工作负载，先通过测试，通过后再开始灰度。
可通过 自动化检测指标 来提高灰度发布的效率。

4. 金丝雀发布（Canary Release）：
同 灰度发布（Canary Deployment）

5. A/B发布（A/B Testing）：
AB发布是一种将新版本应用程序部署到一小部分用户中的方法，以测试新功能或设计。在AB发布期间，新版本的应用程序只会在一小部分用户中使用，以便开发人员可以收集反馈并进行改进。AB测试通常用于优化软件的用户体验、提高转化率或增加收入。在AB测试中，我们可以将用户随机分配到不同的测试组中，然后对比它们在不同版本的软件中的行为和反馈，以确定哪个版本更好。

6. *网关流量灰度发布

需要注意的是，不同的发布策略适用于不同的场景和需求。在选择发布策略时，需要考虑应用程序的复杂性、可用性、稳定性和用户体验等因素。

多种发布策略主要作用相同，都是为了平稳地发布新版本应用，对新版应用可能引入的功能性、非功能性缺陷做可控流程。

|  | 滚动发布 | 灰度发布 | 金丝雀发布 | 蓝绿发布 | A/B发布 | 网关流量灰度发布 |
| --- | --- | --- | --- | --- | --- | --- |
| 特性 | 平滑地从旧版本滚动到新版本 | 在滚动过程增加卡点，用于观察、检测新版服务运行。 | 同灰度发布 开始灰度一个Pod后，只有通过通关测试，才能暴露服务 | 同一时间，新旧版本只有一个版本的Pod提供服务 | 可以基于host的路由，如livetest；或基于userid的路由 或 基于cookie/header的路由，路由到不同的版本来做测试。  | 通过网关层控制流量，从蓝版本灰度发布到新版本 |
| 突出点 | 连续、不间断、可用性 | 新旧对比、缺陷发现、影响面控制 平稳过度、非功能对比  | 金丝雀更突出开始灰度时，对新版本Pod节点的通关检测 | 新旧对比、缺陷发现、可靠性  | AB测试、用户反馈、目标和预期导向，甚至可以同时发布两个或多个版本来测试。 |  |
| 缺点 | 不能控制发布的节奏 | 需要人工介入观察服务运行，消耗一定人力  可通过 自动化检测指标 ，来替代一部分人工 |  | 直接切换流量，不平滑  | 只适用于用户相关等可以做链路标记的场景，需要业务方实现流量分发  |  |
| 适用场景 | 应用改动小，Pod数量少 | 高并发、高性能场景下多Pod微服务的发布 |  | Livetest环境 只读流量的自动化对比 开发测试人员在生产环境做测试 | AB发布可能需要长时间的测试过程，以收集用户行为数据来做不同版本的对比。 |  |

即使只有1个节点，灰度发布、蓝绿发布、滚动发布也有区别。

|  | 滚动发布 | 蓝绿发布 | 金丝雀发布 | 分批灰度 | istio发布 |
| --- | --- | --- | --- | --- | --- |
| 发布速度 | 快 | 快 | 慢 | 慢 | 慢 |
| 发布粒度 | 最少Pod | 整个deployment | 二批次Pod | 三批次Pod | 网络IO流量 |
| 实现复杂度 | 简单 | 中等 | 中等 | 中等 | 复杂 |
|  |  |  |  |  |  |
