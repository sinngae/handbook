软件系统架构的经验和方法论
----

# 架构设计的经验总结

+ 分层架构，在垂直方向分割成不同的多层，负责不同的职责
    + 表示层（前端数据交互）、业务逻辑层（业务规则，又可聚合出业务领域层）、数据访问层（数据存储交互）、数据存储层
    + 洋葱模型、AOP
    + 每层可以内聚一些公共逻辑，单独维护、扩展
+ 模块化设计，在水平方向分割成不同的模块，负责不同的功能
    + 如电商系统，用户管理、订单管理、支付管理、库存管理等
    + 每个模块高内聚，与其他模块通过有限的接口交互
    + 可重用、可测试（便于测试）
+ 解耦设计
    + 通过逻辑、模块重组，降低系统整体的复杂度
    + 1.抽象接口，隐藏具体细节、对外提供一组（可承载功能的）接口原语
    + 2.事件驱动，通过事件发布订阅机制，异步处理业务上可拆分出的逻辑，减少原业务的复杂度、减少组件间耦合
        + 适合高并发场景
    + 3.微服务化，系统拆分为多个独立的服务、通过网络通信，聚合局部逻辑、降低整体复杂度
+ 系统的可扩展性设计
    + 建设能够应对未来需求变化的系统，比如业务变更、用户增多、
    + 1. 性能可扩展，水平扩展、可多服务部署，垂直扩展、适用更高性能的软硬件（如多核、内核特性）
    + 2. 微服务架构，每个微服务独立部署和扩展
        + 快速开发迭代的 Web和业务应用、CRUD的常规业务
    + 3. 微内核架构？中台架构？部分系统提供某类基础功能，其他功能类似插件一样扩展
        + 任务和作业调度应用、工作流应用
    + 负载均衡，网关技术、去单点设计、分布式技术（缓存、数据库等组件）
    + 异步架构、模块化设计、组件化
+ 系统的安全性设计
    + 限流、降级、熔断，防止系统过载、优先保证核心功能可用、熔断
        + 熔断
    + 最小权限原则，生产环境数据、操作的保护，防止敏感数据泄露
        + 授权，限时、限网络环境访问
    + 纵深防御原则？设计复杂的系统、把他人绕晕？
        + 多层次的安全措施，构建多层防线
    + 灾备容错设施，冗余备份、容错机制，服务快速恢复
    + 加密和认证授权，身份认证、授权机制
    + 安全策略和监控，实时监控、入侵检测、
+ 系统的稳定性设计
    + 容错和熔断机制、自动恢复机制
    + 容量规划
        + 容量评估、压测摸底（核心链路压测、全链路压测）
    + 缓存、异步处理
    + 全面的监控体系、告警处理机制、trouble shoot工具
    + 依赖管理
        + 服务发现与注册
        + 依赖管理，弱化、去除、控制依赖

## 熔断设计
避免雪崩效应，提高系统的可用性和用户体验。
在服务调用失败达到阈值时，触发熔断器的打开，切断对被熔断服务的调用，防止故障扩散。
由熔断器直接返回不可用。经过一段时间后，先进入半熔断状态，允许部分请求，成功则恢复调用。
+ 应用场景
    + 高并发场景，容易因为过载而不可用
    + 依赖外部服务，第三方不可用导致服务不可用
    + 网络不稳定场景，避免因网络问题引发的级联故障
+ 熔断设计
    + 合理阈值、恢复策略、监控和日志、测试

熔断是应对（负载还没上来的网络、组件等）异常的容错，限流是应对超过正常负载的保护。
系统是复杂的，正常负载下 局部的异常可能导致整体的处理性能下降，进而雪崩。


# 方法论
+ TOGAF
    + 企业级架构方法论：
    + 架构愿景=》业务架构=》信息系统架构=》技术架构
+ DDD 领域驱动设计
    + 以业务领域为核心，通过领域模型、通用语言、限界上下文等概念来理解和应对业务复杂性。
    + 有效处理复杂业务逻辑，通过分割成限界上下文减少系统的复杂性（业务类的、技术类的、组件类的）
    + 适用于复杂的业务系统建模，初始需要弄懂一堆新概念
+ 微服务架构方法论
    + 把系统拆分为多个小颗粒度的、自治的服务（自治指的是专注于特定的业务功能、独立开发部署扩展）
    + 优点是提高了系统的可扩展性和容错能力，更高的开发灵活性和团队独立性
    + 服务的数量增加很多，需要成熟的DevOps 和 CI/CD支持
+ SOA
    + 良好的接口和契约、企业服务总线通信
    + 需要采购对应的软件套件
+ 敏捷架构
    + 以迭代和增量的管理为核心的系统设计和开发方法
    + Scrum、看板
    + 关注系统架构的持续演进和改进，允许一定的调整和优化
    + 适合快速变化的业务需求
    + 可能缺乏整体视角和长远规划

